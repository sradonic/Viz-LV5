<!--Z5-1. Izraditi kartu RH te dodati <div> element unutar kojega će se ispisati naziv županije
prilikom prelaska miša iznad karte.-->

<!doctype html>
<html lang="en">
<head>
	
	<style>
	div.tooltip {	
    position: absolute;			
    text-align: center;	
    width: 100px;					
    height: 45px;	
    padding: 3px;	
    font: 12px sans-serif;		
    background: green;	
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;
	color:white;
}
	div.legend{
	position: absolute;			
    text-align: center;	
    width: 260px;					
    height: 83px;		
    padding: 3px;	
    font: 12px sans-serif;		
    background: orange;	
    border: 1px solid red;		
    border-radius: 2px;			
    pointer-events: none;
	color:white;}
	
	</style>
    <script src="https://d3js.org/d3.v3.min.js"></script>
	<script src="https://d3js.org/topojson.v1.min.js"></script>
</head>
<body>
  <script>
	var width = 960;
	var height = 700;
	var centered;
	
	var projection = d3.geo.mercator()
		.center([0, 10])
		.scale(6000)
		.translate([17600, 4500])
		.rotate([-180, 0]);
		
	var path = d3.geo.path()
		.projection(projection);
		
	var svg = d3.select("body").append("svg")
		.attr("width", width)
		.attr("height", height)
		.style("background", "white");
	
	var div = d3.select("body").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0);
	
	var ldiv = d3.select("body").append("div")
	.attr("class", "legend")
	.style("opacity", 0);
		
	d3.json("cro_regv3.json", function(error, cro) {
	  var data = topojson.feature(cro, cro.objects.layer1);
	  var states = svg.selectAll("path.county")
		.data(data.features)
		.enter()
		.append("path")
		.attr("class", "county")
		.attr("id", function(d) { return d.id; })
		.attr("d", path)
		.style("fill", "red")
		.style("stroke", "gray")
		.style("stroke-width", 1)
		.style("stroke-opacity", 1)	
		.on("click", clicked)
		.on("mouseover", function(d) {
			var name = d.properties.name;
			var type = d.properties.type;
			console.log(name + " " + type);
			div .transition()
				.duration(200)
				.style("opacity", .9);
			div .html(name + " " +type)
				.style("left", (d3.event.pageX) + "px")     
                .style("top", (d3.event.pageY - 28) + "px");  
				})
		.on("mouseout", function(d) {
			div .transition()
				.style("opacity", 0);
});	

  });
	
	
	function clicked(d) 
	{
		var x, y, k;

		var name = d.properties.gns_name;
			//var type = d.properties.type;
			var isoA = d.properties.iso_a2;
			var admin = d.properties.adm1_code;
			var engname = d.properties.name_alt;
			var engtype = d.properties.type_en;
			var country = d.properties.admin;
			var codeH = d.properties.code_hasc;
			var postal = d.properties.postal;
			var latitude = d.properties.latitude;
			var longitude = d.properties.longitude;
			var geunit = d.properties.geounit;
		
		var centroid = path.centroid(d);
		x = centroid[0];
		y = centroid[1];
		k = 4;
		centered = d;
		
		var zoom = svg.selectAll("path.county")
			.classed("active", centered && function(d) { return d === centered; })
			.transition()
			.duration(750)
			.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
			.style("stroke-width", 1.5 / k + "px")
			.transition()
			.delay(10000)
			.attr("transform", "translate(" + width*2 + "," + height*2 + ")scale(" + k + ")transale (" + x + "," + y + ")")
			.style("stroke-width", 1);
			
			ldiv .transition()
				.duration(200)
				.style("opacity", 1);
			ldiv .html("Naziv: " + name + " " + isoA + "<br>" + "Admin: " + admin + "<br>" + "Name: " + engname + " " + engtype + " " +", " + country + "<br>" + "Postanski broj: " + postal + "<br>" + "Longitude: " + longitude + "<br>" + "Latitude: " + latitude)
				.style("left", (960) + "px")     
                .style("top", (100) + "px");  
			ldiv .transition()
				 .duration(200)
				 .delay(9600)
				 .style("opacity", 0);
				
	}
	
    </script>
</body>
</html>
